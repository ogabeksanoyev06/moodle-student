"use strict";(self["webpackChunkmoodle_student"]=self["webpackChunkmoodle_student"]||[]).push([[730],{7592:function(t,e,s){s.d(e,{Z:function(){return d}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"modal"},[e("div",{staticClass:"modal__content",class:t.className,style:t.style},[e("div",{staticClass:"modal__wrap"},[e("div",{staticClass:"modal__header"},[e("span",[t._t("modalHeader")],2),e("button",{staticClass:"modal__close",on:{click:t.close}},[e("img",{attrs:{src:"/icons/close.svg",alt:""}})])]),e("div",{staticClass:"modal__body"},[t._t("modalBody")],2)])])])},a=[],n=(s(7658),{name:"AppModal",data(){return{hidden:!0}},props:{width:{type:[Number,String]}},computed:{className(){const t="modal__content--",e=[];return this.width&&e.push(t+"wd"),e},style(){const t={};return this.width&&(t["--wd"]=this.width+"px"),t}},methods:{close(){this.hidden=!0,this.$emit("close")}},async mounted(){setTimeout((()=>{this.hidden=!1}),10)}}),o=n,l=s(1001),c=(0,l.Z)(o,i,a,!1,null,"33e1ce04",null),d=c.exports},5730:function(t,e,s){s.r(e),s.d(e,{default:function(){return h}});var i=function(){var t=this,e=t._self._c;return e("section",[e("div",{staticClass:"test"},[e("div",{staticClass:"test_left"},[e("div",{ref:"testBody",staticClass:"test_body"},[e("div",{staticClass:"test_subject"},t._l(t.questions,(function(s,i){return e("div",{key:i,ref:"question_"+i,refInFor:!0,staticClass:"test_question"},[e("div",{staticClass:"test_question-title pt-1"},[e("AppText",{attrs:{size:16,weight:600}},[e("span",{domProps:{innerHTML:t._s(s.name)}})])],1),e("ul",{staticClass:"test_answers pb-1"},t._l(s.answers,(function(i,a){return e("li",{key:a,class:i.is_selected?"test_answers-title active":"test_answers-title",on:{click:function(e){return t.selectAnswer(s.id,i.id)}}},[e("AppText",{staticClass:"mr-1",attrs:{size:t.isMobile?14:16,"line-height":t.isMobile?20:24,weight:"600"}},[t._v(" "+t._s(t.answerLabels[a]+")")+" ")]),e("AppText",{attrs:{size:(t.isMobile,14),"line-height":t.isMobile?20:24,weight:"500"}},[e("span",{domProps:{innerHTML:t._s(i.name)}})])],1)})),0)])})),0)])]),e("div",{staticClass:"test_right"},[e("div",{staticClass:"test_pagination-top"},[e("span",{staticStyle:{"font-size":"1.7rem","max-width":"200px",border:"1px solid #00b74a",color:"#00b74a",padding:"0 10px"}},[t._v(" "+t._s(t.timerFormat(t.testTimer))+" ")]),e("button",{staticClass:"btn btn-danger",staticStyle:{width:"fit-content !important"},on:{click:t.checkLogOut}},[t._v(" Yopish ")])]),e("ul",{staticClass:"test_pagination"},t._l(t.questions,(function(s,i){return e("li",{key:i,class:s.is_selected?"test_pagination-item active":"test_pagination-item",on:{click:function(e){return t.scrollToQuestion(i)}}},[t._v(" "+t._s(i+1)+" ")])})),0),e("div",{staticClass:"test_pagination-bottom"},[e("button",{on:{click:t.showModalClick}},[t._v("Yakunlash")])])])]),e("AppModal",{class:{visible:t.showModal},attrs:{width:300},on:{close:t.closeModal},scopedSlots:t._u([{key:"modalHeader",fn:function(){return[t._v(" Testni yakunlamoqchimisiz ?")]},proxy:!0},{key:"modalBody",fn:function(){return[e("div",{staticClass:"buttons",on:{click:t.closeModal}},[e("button",{staticClass:"btn btn-danger"},[t._v(" Yo'q ")]),e("button",{staticClass:"btn btn-success",on:{click:t.finishTest}},[t._v(" Ha ")])])]},proxy:!0}])}),e("div",{staticClass:"overlay",class:{visible:t.showModal},on:{click:t.closeModal}})],1)},a=[],n=(s(7658),s(7592)),o=s(3822),l={components:{AppModal:n.Z},name:"AppTest",data(){return{questions:[],select:[],exam_id:"",exam_detail:null,ip_address:"",student_id:"",answerLabels:["A","B","C","D","E","F","G","H"],testTimer:0,activeP:0,showModal:!1}},methods:{...(0,o.nv)(["getUser"]),scrollToQuestion(t){const e=this.$refs["question_"+t][0];e&&e.scrollIntoView({behavior:"smooth"}),this.activeP=t},async getExamTest(){this.loading=!0,await this.$http.post("test/begin/",{exam:this.exam_id,ip_address:this.ip_address,student:this.student_id}).then((t=>{t.forEach((t=>{let e={id:t.id,name:t.name,answers:t.answers.map((t=>({...t,is_selected:!1}))),is_selected:!1};this.questions.push(e)}))})).catch((t=>{this.notificationMessage(t.response.data.message,"error")})).finally((()=>{this.loading=!1}))},async resultCreate(){const t={exam:this.exam_id,student:this.student_id,group:this.user.group.id,ip_address:this.ip_address,attempts:this.exam_detail.attempts,total_count:this.exam_detail.total_count,max_score:this.exam_detail.max_score,end_time:this.exam_detail.end_time,is_start:!0,exam_time:this.exam_detail.exam_time,correct_answer:0};await this.$http.post("result/create",t).then((t=>{console.log("res",t),this.testTimer=Math.abs(t.exam_time_second)})).catch((t=>{if(t.response&&t.response.data){const e=t.response.data;for(const t in e)if(Object.hasOwnProperty.call(e,t)){const s=e[t];this.notificationMessage(`${t}: ${s.join(", ")}`,"error")}}})).finally((()=>{}))},getDefault(){this.$http.get(`student-select-answers-get/${this.exam_id}/for/${this.student_id}/`).then((t=>{this.select=t.data,this.collectSelect()})).catch((t=>{console.log(t)}))},async getExamDetail(){await this.$http.get(`exam-detail/${this.exam_id}`).then((t=>{this.exam_detail=t})).catch((()=>{})).finally((()=>{}))},setTimer(){let t=this,e=setInterval((function(){if(t.testTimer/60<=0)return t.finishTest(),void clearInterval(e);t.testTimer--}),1e3)},timerFormat(t){let e=parseInt(t,10),s=Math.floor(e/3600),i=Math.floor((e-3600*s)/60),a=e-3600*s-60*i;return s<10&&(s="0"+s),i<10&&(i="0"+i),a<10&&(a="0"+a),s+":"+i+":"+a},async fetchLocalIPAddress(){try{const t=await this.getIPAddressViaWebRTC();if(t)return t;const e=await this.getIPAddressViaService();return e||null}catch(t){return console.error("Error fetching local IP address:",t),null}},async getIPAddressViaWebRTC(){return new Promise((t=>{window.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;const e=new RTCPeerConnection;e.createDataChannel(""),e.createOffer().then((t=>{e.setLocalDescription(t)})),e.onicecandidate=s=>{if(s&&s.candidate&&s.candidate.candidate){const e=/\d+\.\d+\.\d+\.\d+/,i=e.exec(s.candidate.candidate);if(i){const e=i[0];t(e)}}e.onicecandidate=null,e.close()}}))},async getIPAddressViaService(){try{const t=await fetch("https://api.ipify.org?format=json"),e=await t.json();return e.ip}catch(t){return console.error("Error fetching IP address via service:",t),null}},selectAnswer(t,e){this.fetchLocalIPAddress().then((t=>{this.ip_address=t})),this.$http.patch(`student-exam-answers/${this.exam_id}/for/${this.student_id}/`,{question:t,is_selected:e,ip_address:this.ip_address}).then((t=>{this.select=t,this.collectSelect(),console.log(this.questions),console.log(t)})).catch((t=>{console.log(t)})).finally((()=>{}))},collectSelect(){this.select.forEach((t=>{const e=t.question,s=t.is_selected,i=this.questions.find((t=>t.id===e));if(i){i.is_selected=!0,i.answers.forEach((t=>{t.is_selected=!1}));const t=i.answers.find((t=>t.id===s));t&&(t.is_selected=!0)}}))},finishTest(){this.$http.get(`exam-finish/${this.exam_id}/finish/${this.student_id}/`).then((()=>{})).catch((t=>{console.log(t)}))},closeModal(){this.showModal=!1,document.body.style.overflowY="scroll"},showModalClick(){this.showModal=!0,document.body.style.overflowY="hidden"},checkLogOut(){this.$http.post("check-logout/",{exam:this.exam_id,student:this.student_id}).then((()=>{this.$router.replace({name:"test-exams"})})).catch((()=>{}))},handleBeforeUnload(t){t.preventDefault();const e={exam:this.exam_id,student:this.student_id},s=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon("https://api.fastlms.uz/api/check-logout/",s)}},beforeDestroy(){window.removeEventListener("beforeunload",this.handleBeforeUnload),this.checkLogOut()},computed:{...(0,o.Se)(["user"])},async mounted(){window.addEventListener("beforeunload",this.handleBeforeUnload),this.fetchLocalIPAddress().then((t=>{this.ip_address=t})),await this.getUser(),await this.getExamDetail(),await this.resultCreate(),await this.getExamTest(),this.setTimer(),this.getDefault()},created(){this.exam_id=this.$route.params.exam_id,this.student_id=localStorage.getItem("student_id")}},c=l,d=s(1001),r=(0,d.Z)(c,i,a,!1,null,"4ab40660",null),h=r.exports}}]);
//# sourceMappingURL=730.32e6f5e5.js.map